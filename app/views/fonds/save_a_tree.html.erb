<% container_class "container-fluid" %>

<% content_for :status_bar do %>
  <h2><%= t('listing_fonds') %><%= path_separator %><%= t('import_tree') %></h2>
  <div id="links">
    <%= link_to_index "Lista complessi", fonds_path %>
  </div>
<% end %>

<div class="span8">
<%# TAI aggiunto = prima di form_tag %>
  <%= form_tag({:action => 'saving_the_tree'}, {:method => 'post', :class => "skip-prompt"}) do %>
  
<%# Upgrade 2.2.0 inizio %>
	<% if current_user.is_multi_group_user?() %>
		<div style="margin-bottom: 10px;">
			<div style="text-align: justify;">
				Per eseguire l'operazione è necessario selezionare il gruppo cui associare il nuovo complesso archivistico scegliendolo tra i gruppi associati all'utente corrente.
			</div>
			<div style="margin-top: 10px;">
				<%= label_tag :group_id, raw(t('devise.attributes.group_id') + required_marker + '<span class="inline-msg hide">obbligatorio</span>'), :class => "control-label" %>            
				<%= select :tree, :group_id, rel_user_groups_select(current_user.rel_user_groups), {:prompt => t('devise.attributes.group_id_prompt'), :selected => current_user.rel_user_groups[0].group_id} %>
			</div>
		</div>
	<% else %>
		<%= hidden_field_tag 'tree[group_id]', current_ability.target_group_id %>
	<% end %>
<%# Upgrade 2.2.0 fine %>
	
  <p style="margin-bottom: 2em;">Scrivi la struttura del complesso archivistico nel campo di testo, un livello per riga, oppure scegli un modello predefinito liberamente modificabile.</p>

	<p>
    <%= select(:tree, :predefined_templates, options_from_collection_for_select(@select_options, 'first', 'last'), {:prompt => "--- Scegli modello predefinito ---"}, { :id => 'template-selector', :class => "span5" }) %>
  </p>
  <p>
    <%= text_area_tag :tree_template, content = params[:tree_template], :id => 'template-text', :style => "width: 98%; height: 40em;" %>
  </p>
  <p><%= submit_tag t('import_tree'), :class => "btn btn-primary" %></p>
<% end %>
</div>

<div class="span4">
    <p><strong>Regole</strong></p>
    <p>La denominazione del livello deve essere preceduta dal carattere <code>#</code>.</p>
    <p>Le occorrenze del carattere # denotano il livello: # significa primo livello, ## secondo livello, ### terzo livello, ecc.</p>
    <p>Dopo il livello, è possibile inserire la tipologia del complesso preceduta dal carattere <code>@</code>.</p>
    <p>Esempio:</p>
    <p><pre># Fondo Tal dei Tali @ fondo</pre></p>

    <p style="margin-top: 2em;"><%= link_to "Lista delle tipologie valide", "#", :'data-toggle' => "collapse", :'data-target' => "#fond-types" %></p>
    <div id="fond-types" class="collapse">
      <ul>
      <% @fond_types.each do |ft| %>
        <li><%= ft %></li>
      <% end %>
      </ul>
    </div>
</div>

</div>